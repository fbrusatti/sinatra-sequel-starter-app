<!DOCTYPE html>

<html>
    <head>
        <title>
          Survey
        </title>
    </head>

    <body class="page">
        <div id="create-survey" class="box">
            <label for="username">Nombre:</label>
            <input id="username" type="text" placeholder="Pepito" />

            <button>
                Agregar
            </button>
        </div>


            <button onclick="sendForm()" style="width: 24rem; height: 3rem; cursor: pointer;">
                        Registrar respuesta
                    </button>
        <div class="container">
            <form>
                <% @questions.each do |question| %>
                <div class="box">
                    <h2>
                        <%= question.name %>
                    </h2>

                    <% question.choices.each do |choice| %>
                    <div class="form-group">
                        <label class="form-group-label" for="<%= choice.text  %>"><%= choice.text  %></label>
                        <input
                            name="<%= question.id  %>"
                            type="radio"
                            data-choice-id="<%= choice.id %>"
                            data-choice-text="<%= choice.text %>"
                            data-question-id="<%= question.id %>"
                            data-question-name="<%= question.name %>"
                        >
                    </div>
                    <% end %>

                    <div class="form-group">
                        <label class="form-group-label" for="no-choice">
                            <% if question.choices.length() > 1 %>
                                Ninguna de las anteriores
                            <% else %>
                                No
                            <% end %>
                        </label>
                        <input name="<%= question.name  %>" type="radio" value="false">
                    </div>
                </div>
                <% end %>

                <div style="width: 100%; display: flex; justify-content: center;">
                    
                </div>
            </form>

        </div>
    </body>
</html>

<script>
function sendForm() {
    const choicesSelected = getChoicesSelected();

    makeRequest('POST', '/make_survey/finish', choicesSelected);
}

function getChoicesSelected() {
    const inputsInHTML = document.getElementsByTagName('input');

    const inputsInHTMLInArray = Array.prototype.slice.call(inputsInHTML, 0);

    const choicesSelectedInHTML = inputsInHTMLInArray.filter(inputInHTML => inputInHTML.checked);

    return choicesSelectedInHTML.map(choiceInHTML => ({
        ...choiceInHTML.dataset
    }));
}

function makeRequest(method, action, params) {
    const xhr = new XMLHttpRequest();

    xhr.open(method, action);

    xhr.setRequestHeader('Content-Type', 'application/json');

    xhr.send(JSON.stringify(params));
}
</script>

<style>
    .page {
        background-color: #7f8c8d;

        font-family: arial;

        color: #ecf0f1;

        justify-content: center;

        display: flex;
        flex-direction: column;
    }

    .box {
        padding: 1rem;
        margin: 1rem;

        border-radius: 1rem;

        display: flex;
        flex-direction: column;

        background-color: #2c3e50;

        border-color: #95a5a6;

        width: 60%;
    }

    #username {
        border: 1px solid;

        margin-top: 1rem;

        width: 95%;
        height: 2rem;

        border-radius: 10px;

        border-color: #95a5a6;

        padding: 0 10px;

        font-size: 1.2rem;

        font-weight: bold;
    }

    form {
        display: flex;
        flex-direction: column;

    }

    h2 {
        font-weight: normal;

        font-size: 20px;

        margin: 1rem;
    }

    .form-group {
        display: flex;
        flex-direction: row;

        align-items: center;

        justify-content: space-between;

        margin: 1rem;

        padding: 1rem;

        border-radius: 10px;

        background-color: #34495e;

        font-weight: lighter;
        font-size: 16px;
    }

    .form-group-label {
        width: 70%;
    }

    #create-survey {
        width: 50%;

        justify-content: center;
    }

    button {
        padding: 0.5rem;
        margin: 0.5rem;

        border-radius: 10px;

        background-color: #f39c12;

        width: 8rem;

        border: 1px solid #e67e22;

        color: #2c3e50;

        cursor: pointer;

        font-weight: bold;
    }

    .choice {
        display: flex;
        flex-direction: row;

    }

    .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-content: center;
    }
</style>